<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cyberracing</title>
</head>
<body style="margin: 0; padding: 0">
    <canvas id="game-canvas" style="display: block">
        Your browser doesn't appear to support the
        <code>&lt;canvas&gt;</code> element.
    </canvas>


<!--SCRIPTS-->
    <!--testing shader-->
    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec3 aVertexPosition;
        attribute vec4 aColor;

        uniform mat4 uMMatrix;
        uniform mat4 uVMatrix;
        uniform mat4 uPMatrix;

        varying vec4 vColor;

        void main()
        {
            vColor = aColor;
            gl_Position = uPMatrix * uVMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
        }
    </script>
    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;

        varying vec4 vColor;

        void main()
        {
            gl_FragColor = vColor;
        }
    </script>

    <script id="vs-flatPhong" type="x-shader/x-vertex">
        attribute vec3 aVertexPosition;
        attribute vec3 aFacePosition;
        attribute vec3 aFaceNormal;
        attribute vec3 aVertexNormal;

        uniform vec4 uMaterialColor;
        uniform mat4 uMVMatrix;
        uniform mat4 uMVPMatrix;
        uniform mat4 uNormalMatrix;

        //lights
        uniform light_info uLight[64];
        uniform int uNumLights;
        uniform material_info uMaterial;


        varying vec4 vPolygonColor;

        struct light_info {
            int   type;
            vec4  color;
            vec4  position;
            vec4  direction;
            float angle;
        };
        struct material_info {
            float kA;
            float kD;
            float kS;
            float roughness;
        };

        // light types
        const int AMBIENT = 0;
        const int DIRECTIONAL = 1;
        const int POINT = 2;
        const int SPOT = 3;

        void main()
        {
            gl_Position = uMVPMatrix * vec4(aVertexPosition, 1.0);
            vec4 facePosition = PVMMatrix * vec4(aFacePosition, 1.0);

            //light
            vec4 ambientPart = uLight[0].color;
            vec4 diffusePart = vec4(0.0, 0.0, 0.0, 1.0);
            vec4 specularPart = vec4(0.0, 0.0, 0.0, 1.0;

            vec4 normal = uNormalMatrix * vec4(aVertexNormal, 1.0);

            int max = min(uNumLights, 64);
            light_info l;
            for(int i = 0, i < max; i++)
            {
                l = uLight[i];
                vec3 vecToLight = normalize(l.position - aVertexPosition);
                switch(l.type)
                {
                    case DIRECTIONAL:
                    {
                        diffusePart += vec4(l.color * max(dot(aVertexNormal, l.direction), 0.0), 0.0);
                    }
                    break;
                    case POINT:
                    {
                        diffusePart += vec4(l.color.xyz * dot(aVertexNormal, vecToLight), 0.0);
                    }
                    break;
                    case SPOT:
                    {

                    }
                    break;
                    default:
                    break;
                }
            }

            vPolygonColor = uMaterial.kA * ambientPart + uMaterial.kD * diffusePart + uMaterial.kS * specularPart;
        }
    </script>
    <script id="fs-flat" type="x-shader/x-fragment">
        varying vec4 vColor;

        void main()
        {
            gl_FragColor = vColor;
        }
    </script>

    <script id="vs-phong" type="x-shader/x-vertex">

    </script>
    <script id="fs-phong" type="x-shader/x-fragment">
        varying vec3 normal;
        varying vec3

    </script>
    <!--general independent utility-->
    <script src="Scripts/gl-matrix.js" type="text/javascript"></script>
    <script src="Scripts/OOP/inheritance.js" type="text/javascript"></script>
    <script src="Scripts/OOP/event.js" type="text/javascript"></script>
    <script src="Scripts/file_reader.js" type="text/javascript"></script>
    <!--math-->
    <script src="Scripts/Math3D/vector.js" type="text/javascript"></script>
    <script src="Scripts/Math3D/matrix.js" type="text/javascript"></script>
    <!--shaders-->
    <script src="Scripts/Shaders/shader_loader.js" type="text/javascript"></script>
    <script src="Scripts/Shaders/materials.js" type="text/javascript"></script>
    <!--scene & sceneobject-->
    <script src="Scripts/Scene/scene.js" type="text/javascript"></script>
    <script src="Scripts/Scene/SceneObject/scene_object.js" type="text/javascript"></script>
    <!--composites-->
    <script src="Scripts/Scene/SceneObject/composite.js" type="text/javascript"></script>
    <script src="Scripts/Scene/SceneObject/Composite/mesh_renderer.js" type="text/javascript"></script>
    <script src="Scripts/Scene/SceneObject/Composite/transform.js" type="text/javascript"></script>
    <script src="Scripts/Scene/SceneObject/Composite/camera.js" type="text/javascript"></script>
    <script src="Scripts/Scene/SceneObject/Composite/light.js" type="text/javascript"></script>

    <!--init: this should be loaded last-->
    <script src="Scripts/init.js" type="text/javascript"></script>
</body>
</html>